import {
	INodeProperties,
} from 'n8n-workflow';

export const vulnerabilityOperations: INodeProperties[] = [
	{
		displayName: 'Operation',
		name: 'operation',
		type: 'options',
		noDataExpression: true,
		displayOptions: {
			show: {
				resource: ['vulnerability'],
			},
		},
		options: [
			{
				name: 'Search',
				value: 'search',
				description: 'Search vulnerabilities with filters',
				action: 'Search vulnerabilities',
			},
			{
				name: 'Get Historical',
				value: 'getHistorical',
				description: 'Get historical vulnerability trends',
				action: 'Get historical vulnerabilities',
			},
			{
				name: 'Get by Target',
				value: 'getByTarget',
				description: 'Get vulnerabilities for specific target',
				action: 'Get vulnerabilities by target',
			},
		],
		default: 'search',
	},
];

export const vulnerabilityFields: INodeProperties[] = [
	// Search operation fields
	{
		displayName: 'Quick Filters',
		name: 'quickFilters',
		type: 'collection',
		placeholder: 'Add Filter',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
		options: [
			{
				displayName: 'High/Critical Only',
				name: 'highCriticalOnly',
				type: 'boolean',
				default: false,
				description: 'Filter to only high and critical severity vulnerabilities (CVSS >= 7.0)',
			},
			{
				displayName: 'Critical Only',
				name: 'criticalOnly',
				type: 'boolean',
				default: false,
				description: 'Filter to only critical severity vulnerabilities (CVSS >= 9.0)',
			},
			{
				displayName: 'Exploitable Only',
				name: 'exploitableOnly',
				type: 'boolean',
				default: false,
				description: 'Filter to only vulnerabilities with EPSS score >= 0.5',
			},
			{
				displayName: 'Production Systems Only',
				name: 'productionOnly',
				type: 'boolean',
				default: false,
				description: 'Filter to only production systems (hostname patterns: prod-*, production-*)',
			},
		],
	},
	{
		displayName: 'CVSS Score Filters',
		name: 'cvssFilters',
		type: 'collection',
		placeholder: 'Add CVSS Filter',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
		options: [
			{
				displayName: 'CVSS v2 Base Score',
				name: 'cveV2BaseScore',
				type: 'number',
				default: 0,
				description: 'Minimum CVSS v2 base score',
			},
			{
				displayName: 'CVSS v3 Base Score',
				name: 'cveV3BaseScore',
				type: 'number',
				default: 0,
				description: 'Minimum CVSS v3 base score',
			},
			{
				displayName: 'EPSS Score',
				name: 'cveEpssScore',
				type: 'number',
				default: 0,
				description: 'Minimum EPSS (Exploit Prediction Scoring System) score',
			},
		],
	},
	{
		displayName: 'CVE Filters',
		name: 'cveFilters',
		type: 'collection',
		placeholder: 'Add CVE Filter',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
		options: [
			{
				displayName: 'CVE IDs',
				name: 'cves',
				type: 'string',
				default: '',
				placeholder: 'CVE-2023-1234, CVE-2023-5678',
				description: 'Comma-separated list of CVE IDs to filter by',
			},
			{
				displayName: 'Vulnerable Products',
				name: 'products',
				type: 'string',
				default: '',
				placeholder: 'Windows 10, Apache 2.4',
				description: 'Comma-separated list of vulnerable products',
			},
			{
				displayName: 'Operating System Only',
				name: 'operatingSystemOnly',
				type: 'boolean',
				default: false,
				description: 'Only include operating system vulnerabilities',
			},
		],
	},
	{
		displayName: 'Target Filters',
		name: 'targetFilters',
		type: 'collection',
		placeholder: 'Add Target Filter',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
		options: [
			{
				displayName: 'Agent UUIDs',
				name: 'agentUuids',
				type: 'string',
				default: '',
				placeholder: 'uuid1, uuid2, uuid3',
				description: 'Comma-separated list of agent UUIDs',
			},
			{
				displayName: 'Hostnames',
				name: 'hostnames',
				type: 'string',
				default: '',
				placeholder: 'server1, server2, server3',
				description: 'Comma-separated list of hostnames',
			},
			{
				displayName: 'Severities',
				name: 'severities',
				type: 'multiOptions',
				options: [
					{
						name: 'Critical',
						value: 'critical',
					},
					{
						name: 'High',
						value: 'high',
					},
					{
						name: 'Medium',
						value: 'medium',
					},
					{
						name: 'Low',
						value: 'low',
					},
				],
				default: [],
				description: 'Filter by vulnerability severity levels',
			},
		],
	},
	{
		displayName: 'Date Range',
		name: 'dateRange',
		type: 'options',
		options: [
			{
				name: 'Last 24 Hours',
				value: 'last24h',
			},
			{
				name: 'Last 7 Days',
				value: 'last7days',
			},
			{
				name: 'Last 30 Days',
				value: 'last30days',
			},
			{
				name: 'Last 90 Days',
				value: 'last90days',
			},
			{
				name: 'Custom',
				value: 'custom',
			},
		],
		default: 'last30days',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
	},
	{
		displayName: 'Custom Date Range',
		name: 'customDateRange',
		type: 'collection',
		placeholder: 'Add Date Range',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
				dateRange: ['custom'],
			},
		},
		options: [
			{
				displayName: 'Scan Time After',
				name: 'vulnerabilityScanTimeAfter',
				type: 'dateTime',
				default: '',
				description: 'Filter vulnerabilities discovered after this date',
			},
			{
				displayName: 'Scan Time Before',
				name: 'vulnerabilityScanTimeBefore',
				type: 'dateTime',
				default: '',
				description: 'Filter vulnerabilities discovered before this date',
			},
		],
	},
	{
		displayName: 'Sort By',
		name: 'sortBy',
		type: 'options',
		options: [
			{
				name: 'Scan Time (Newest First)',
				value: 'vulnerabilityScanTime:desc',
			},
			{
				name: 'Scan Time (Oldest First)',
				value: 'vulnerabilityScanTime:asc',
			},
			{
				name: 'CVSS v3 Score (Highest First)',
				value: 'cveV3BaseScore:desc',
			},
			{
				name: 'CVSS v3 Score (Lowest First)',
				value: 'cveV3BaseScore:asc',
			},
			{
				name: 'CVSS v2 Score (Highest First)',
				value: 'cveV2BaseScore:desc',
			},
			{
				name: 'CVSS v2 Score (Lowest First)',
				value: 'cveV2BaseScore:asc',
			},
		],
		default: 'vulnerabilityScanTime:desc',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
	},
	{
		displayName: 'Limit',
		name: 'limit',
		type: 'number',
		default: 100,
		description: 'Maximum number of results to return (0 = no limit)',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['search'],
			},
		},
	},
	// Historical operation fields
	{
		displayName: 'Date Range',
		name: 'historicalDateRange',
		type: 'options',
		options: [
			{
				name: 'Last Week',
				value: 'lastWeek',
			},
			{
				name: 'Last Month',
				value: 'lastMonth',
			},
			{
				name: 'Last Quarter',
				value: 'lastQuarter',
			},
			{
				name: 'Custom',
				value: 'custom',
			},
		],
		default: 'lastMonth',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getHistorical'],
			},
		},
	},
	{
		displayName: 'Custom Date Range',
		name: 'customHistoricalDateRange',
		type: 'collection',
		placeholder: 'Add Date Range',
		default: {},
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getHistorical'],
				historicalDateRange: ['custom'],
			},
		},
		options: [
			{
				displayName: 'Interval After',
				name: 'intervalAfter',
				type: 'dateTime',
				default: '',
				description: 'Start date for historical data (YYYY-MM-DD format)',
			},
			{
				displayName: 'Interval Before',
				name: 'intervalBefore',
				type: 'dateTime',
				default: '',
				description: 'End date for historical data (YYYY-MM-DD format)',
			},
		],
	},
	{
		displayName: 'Category',
		name: 'category',
		type: 'options',
		options: [
			{
				name: 'New',
				value: 'new',
				description: 'New vulnerabilities discovered',
			},
			{
				name: 'Remediated',
				value: 'remediated',
				description: 'Vulnerabilities that were fixed',
			},
			{
				name: 'Both',
				value: 'both',
				description: 'Both new and remediated vulnerabilities',
			},
		],
		default: 'both',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getHistorical'],
			},
		},
	},
	{
		displayName: 'Group By Severity',
		name: 'groupBySeverity',
		type: 'boolean',
		default: false,
		description: 'Group results by severity level for trend analysis',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getHistorical'],
			},
		},
	},
	// Get by Target operation fields
	{
		displayName: 'Target ID',
		name: 'targetId',
		type: 'number',
		default: 0,
		required: true,
		description: 'The target ID to get vulnerabilities for',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getByTarget'],
			},
		},
	},
	{
		displayName: 'Limit',
		name: 'targetLimit',
		type: 'number',
		default: 100,
		description: 'Maximum number of vulnerabilities to return for this target',
		displayOptions: {
			show: {
				resource: ['vulnerability'],
				operation: ['getByTarget'],
			},
		},
	},
];
